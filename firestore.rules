rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // =============================================
    // Helper Functions
    // =============================================
    function isOwner() {
      // A user is an owner if their UID exists as a document ID in the 'owners' collection.
      return exists(/databases/$(database)/documents/owners/$(request.auth.uid));
    }

    // =============================================
    // Public Read Access
    // =============================================

    // Anyone can read project data for the public portfolio.
    match /projects/{projectId} {
      allow read: if true;
      allow write: if isOwner();
    }
    
    // Site settings (like maintenance mode) are public to read.
    match /settings/site {
        allow read: if true;
        allow write: if isOwner();
    }

    // About page content is public to read.
    match /settings/about {
        allow read: if true;
        allow write: if isOwner();
    }

    // =============================================
    // Authenticated-Only Write
    // =============================================
    
    // Anyone can submit the contact form.
    match /contactFormSubmissions/{submissionId} {
      allow create: if true;
      allow read, update, delete: if isOwner();
    }

    // =============================================
    // Owner & Client Data Access (Simplified)
    // =============================================

    // Default-deny all other collections.
    // The rules below will grant specific access.

    // Owners have full access to everything else.
    // Clients can read their own specific data, but writes are restricted for now to simplify.
    match /{document=**} {
      allow read, write: if isOwner();
    }
  }
}
